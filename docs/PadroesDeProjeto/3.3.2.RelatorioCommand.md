# Relatório de Implementação do Padrão Command

## 1. Padrão Command (Comportamental)

O padrão **Command** foi implementado para encapsular a solicitação de registro de uma ação sustentável como um objeto, permitindo que o componente de interface (o *Invoker*) execute a lógica de negócio sem saber os detalhes da sua implementação (o *Receiver*).

### 1.1. Contexto de Aplicação: Registro de Ações Sustentáveis

O padrão foi aplicado na página `src/pages/Actions.tsx`, onde o usuário registra uma **Ação Sustentável** (e.g., Reciclagem, Transporte Público).

### 1.2. Estrutura da Implementação

A implementação foi realizada no arquivo `src/lib/ActionCommand.ts`.

| Elemento do Padrão | Classe/Interface | Descrição |
| :--- | :--- | :--- |
| **Command** | `interface Command` | Define o método `execute()`. |
| **Receiver** | `class ActionReceiver` | Contém a lógica de negócio para registrar e, opcionalmente, desfazer a ação. |
| **Concrete Command** | `class RegisterActionCommand` | Implementa a interface `Command` e delega a execução ao `ActionReceiver`. |
| **Invoker** | `Actions.tsx` (função `handleSubmit`) | Cria uma instância do `RegisterActionCommand` e chama o método `execute()`. |

### 1.3. Diagrama de Classes

O diagrama a seguir ilustra a estrutura do padrão Command aplicada ao registro de ações:

![Modelagem do Padrão Builder para Registro de Consumo](./assets/command.jpeg)

*   **ICommand (Command):** Interface que define o contrato `execute()`.
*   **NavigateCommand (Concrete Command):** Representa o `RegisterActionCommand` que encapsula a lógica de registro.
*   **HomeNavbar (Invoker):** Representa o componente `Actions.tsx` que cria e invoca o comando.
*   **Button (Client):** O botão que dispara a chamada ao Invoker. O **Receiver** (`ActionReceiver`) não está visível no diagrama fornecido, mas é onde a lógica de negócio reside.

### 1.4. Código Fonte (`src/lib/ActionCommand.ts`)

O código abaixo define a estrutura do padrão Command:

\`\`\`typescript
// 1. Interface do Command
export interface Command {
  // Função: Método principal que executa a solicitação.
  execute: () => void;
}

// 2. Receiver (A classe que executa a lógica de negócio)
class ActionReceiver {
  // ... (propriedades do construtor)

  // Função: Simula o envio da ação para o backend e exibe um toast.
  public registerAction() {
    // ... (lógica de registro e cálculo de pontos)
    
    // Inclui a opção de desfazer no toast
    toast({
      // ...
      action: {
        label: "Desfazer",
        onClick: () => this.undoRegistration(),
      } as ToastActionElement,
    });
  }

  // Função: Simula a reversão da ação, demonstrando a capacidade do Command.
  public undoRegistration() {
    console.log(\`Desfazendo registro da ação: ${this.action.title}\`);
    toast({
      title: "Ação desfeita",
      description: \`O registro de '${this.action.title}' foi cancelado.\`,
    });
  }
}

// 3. Concrete Command
export class RegisterActionCommand implements Command {
  private receiver: ActionReceiver;

  // Função: Construtor que recebe os dados necessários e cria o Receiver.
  constructor(
    action: { id: string; title: string; points: number },
    description: string,
    location: string
  ) {
    this.receiver = new ActionReceiver(action, description, location);
  }

  // Função: Implementa o método execute, chamando o método correspondente no Receiver.
  public execute(): void {
    this.receiver.registerAction();
  }
}
\`\`\`

### 1.5. Invocador (Actions.tsx)

O componente `Actions.tsx` atua como o **Invoker**, criando e executando o comando quando o botão de registro é pressionado:

\`\`\`typescript
// Trecho de src/pages/Actions.tsx

const handleSubmit = (description: string, location: string) => {
  // ... (validações)

  const action = actionTypes.find(a => a.id === selectedAction);

  if (action) {
    // 4. Invoker: Cria e executa o comando
    const command = new RegisterActionCommand(action, description, location);
    command.execute(); // Chama o método execute() do comando
  }
  
  // ... (limpeza de estado)
};
\`\`\`

### 1.6. Benefícios

*   **Desacoplamento:** O componente `Actions.tsx` (Invoker) está desacoplado da lógica de negócio real (Receiver), dependendo apenas da interface `Command`.
*   **Capacidade de Desfazer:** A estrutura do Command facilita a implementação de um mecanismo de desfazer (`undoRegistration`), que foi simulado através de uma ação no *toast* de notificação.

**Arquivos Envolvidos:**
*   `src/pages/Actions.tsx` (Modificado)
*   `src/lib/ActionCommand.ts` (Criado)

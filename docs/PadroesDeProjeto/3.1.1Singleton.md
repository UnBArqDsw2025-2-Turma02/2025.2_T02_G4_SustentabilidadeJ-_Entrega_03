# GOF Criacional - Singleton

## Introdução 

O Singleton é um tipo de GOF criacional que tem como objetivo criar uma única instância e que seja facilmente acessível através de um ponto de acesso global <a id="anchor_1" href=#FRM1> [1]</a> (Gamma et al., 1994). Esse padrão é especialmente relevante no contexto do projeto, pois garante que determinados serviços mantenham uma única instância controlada, evitando inconsistências e uso desnecessário de recursos.

## Contexto no Projeto

Para aplicar o padrão **Singleton** no projeto, foi necessário criar as classes responsáveis por gerenciar o serviço de tokens, implementadas utilizando o framework **Django**.  
A implementação pode ser observada no arquivo [`App/tokens/servicos/token_servico.py`](https://github.com/UnBArqDsw2025-2-Turma02/2025.2_T02_G4_SustentabilidadeJ-_Entrega_02/blob/main/App/tokens/servicos/token_servico.py), especificamente na classe **`TokenService`**, cujo propósito é **garantir uma única instância do serviço de tokens em toda a aplicação**.

A utilização desse padrão está em conformidade com os diagramas elaborados na modelagem do projeto, conforme pode ser visto em:  
- [**Diagrama de Sequência – Registrar Ação Sustentável**](https://github.com/UnBArqDsw2025-2-Turma02/2025.2_T02_G4_SustentabilidadeJ-_Entrega_02/blob/main/docs/Modelagem/2.2.1.DiagramaDeSequencia.md)  
- [**Diagrama de Pacotes**](https://github.com/UnBArqDsw2025-2-Turma02/2025.2_T02_G4_SustentabilidadeJ-_Entrega_02/blob/main/docs/Modelagem/2.3.1.DiagramaDePacote.md)


## Metodologia

A organização do código foi orientada pelos **artefatos desenvolvidos na Entrega 2**, em especial o **Diagrama de Sequência** e o **Diagrama de Pacotes**, que serviram como base para estruturar o serviço responsável pelo gerenciamento de tokens.  

Seguindo esses diagramas, o grupo manteve a consistência da arquitetura planejada, posicionando a implementação do padrão **Singleton** dentro da estrutura de pastas **`App/tokens`**, conforme definido na modelagem anterior.

O **diagrama do Singleton** foi desenvolvido pelos integrantes responsáveis pelos artefatos de modelagem, com base na **interpretação direta do código-fonte** da classe `TokenService`. Esse processo de modelagem pós-implementação foi adotado para garantir que o diagrama refletisse fielmente a **estrutura real da aplicação**, assegurando a qualidade e a precisão da documentação.


## Singleton implementado no projeto

A seguir, está o código em python da classe TokenService com a implementação do singleton:

```python
from .token_strategy import (
    ReciclagemStrategy, TransporteStrategy,
    EconomiaRecursosStrategy, DescarteCorretoStrategy,
    PlantioArvoreStrategy
)

class TokenService:
    """Serviço de gerenciamento de tokens usando padrões Singleton e Strategy."""

    _instance = None

    def __new__(cls):
        """Implementa padrão Singleton."""
        if cls._instance is None:
            cls._instance = super(TokenService, cls).__new__(cls)
        return cls._instance

    def __init__(self):
        """Inicializa estratégias de cálculo de tokens."""
        if not hasattr(self, "estrategias"):
            self.estrategias = {
                "Reciclagem": ReciclagemStrategy(),
                "Transporte": TransporteStrategy(),
                "EconomiaRecursos": EconomiaRecursosStrategy(),
                "DescarteCorreto": DescarteCorretoStrategy(),
                "PlantioArvore": PlantioArvoreStrategy()
            }
            self.strategies = self.estrategias

    def registrar_tokens(self, usuario, acao):
        """Calcula e atribui tokens ao usuário baseado na ação."""
        estrategia = self.estrategias.get(acao.tipoAcao)

        if not estrategia:
            return 0

        tokens = estrategia.calcular_tokens(acao)
        usuario.saldoTokens += tokens

        return tokens

    def obter_estrategia(self, tipo_acao):
        """Retorna a estratégia de cálculo para um tipo de ação."""
        return self.estrategias.get(tipo_acao)

    def listar_tipos_disponiveis(self):
        """Lista tipos de ações disponíveis."""
        return list(self.estrategias.keys())
```


## Diagrama

## Teste

## Participação na Produção do Artefato

| Nome do Integrante | Artefato | Descrição da Contribuição | Análise Crítica |
|--------------------|----------|---------------------------|-----------------|
| Lucas Mendonça Arruda | Diagrama Singleton e  |  |  |

## Conclusão

O padrão **Singleton** implementado no projeto *SustentabilidadeJá* demonstrou ser uma solução eficaz para garantir que o serviço de tokens possua **uma única instância acessível globalmente**, evitando inconsistências e uso redundante de recursos.  

A aplicação do padrão foi guiada pelos **diagramas de modelagem da Entrega 2**, o que permitiu ao grupo manter a **consistência arquitetural** e assegurar que a implementação estivesse alinhada com o planejamento definido previamente.  
Ademais, o diagrama do Singleton construído a partir da interpretação do código-fonte confirmou a correta estruturação da classe `TokenService` e permitiu uma documentação clara para futuras manutenções ou extensões.  



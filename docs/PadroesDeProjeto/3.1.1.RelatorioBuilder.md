# Relatório de Implementação do Padrão Builder

## 1. Padrão Builder (Criacional)

O padrão **Builder** foi utilizado para separar a construção de um objeto complexo (o **Produto**) de sua representação, permitindo que o mesmo processo de construção crie diferentes representações.

### 1.1. Contexto de Aplicação: Construção de Registro de Consumo

O padrão foi aplicado na página `src/pages/Upload.tsx`, que lida com o upload e registro de contas de Água e Energia. O objeto a ser construído é o **Registro de Consumo** (`ConsumptionRecord`), que possui múltiplos atributos (arquivo, valor, consumo) que são preenchidos em etapas.

### 1.2. Estrutura da Implementação

A implementação foi realizada no arquivo `src/lib/ConsumptionRecordBuilder.ts`.

| Elemento do Padrão | Classe/Interface | Descrição |
| :--- | :--- | :--- |
| **Product** | `interface ConsumptionRecord` | O objeto complexo a ser construído, representando uma conta de consumo. |
| **Builder** | `class ConsumptionRecordBuilder` | Define os métodos para construção passo a passo (`setFile`, `setValue`, `setConsumption`) e o método final `build()`. |
| **Director** | `Upload.tsx` (função `handleSubmit`) | Coordena a ordem dos passos de construção, utilizando o `Builder` para montar o `ConsumptionRecord`. |

### 1.3. Diagrama de Classes

O diagrama a seguir ilustra a estrutura do padrão Builder aplicada à construção do registro de consumo:

![Modelagem do Padrão Builder para Registro de Consumo](./assets/builder.jpeg)

*   **Product:** Representa o `ConsumptionRecord`.
*   **Builder:** Representa a interface do Builder (implícita no `ConsumptionRecordBuilder`).
*   **ConcreteBuilder:** Representa a classe `ConsumptionRecordBuilder` com seus métodos de construção.
*   **Diretor:** Representa a função `handleSubmit` no `Upload.tsx` que orquestra a construção.

### 1.4. Código Fonte (`src/lib/ConsumptionRecordBuilder.ts`)

O código abaixo define a estrutura do padrão Builder:

\`\`\`typescript
// 1. O Produto
export interface ConsumptionRecord {
  type: 'agua' | 'energia';
  file: File | null;
  value: number | null;
  consumption: number | null;
}

// 2. O Builder
export class ConsumptionRecordBuilder {
  private record: ConsumptionRecord;

  // Função: Inicializa o objeto Produto.
  constructor(type: 'agua' | 'energia') {
    this.record = {
      type: type,
      file: null,
      value: null,
      consumption: null,
    };
  }

  // Função: Define o arquivo e retorna a própria instância (encadeamento).
  public setFile(file: File | null): ConsumptionRecordBuilder {
    this.record.file = file;
    return this;
  }

  // Função: Define o valor, incluindo a lógica de conversão de string para number.
  public setValue(value: string): ConsumptionRecordBuilder {
    const numericValue = parseFloat(value.replace(',', '.'));
    this.record.value = isNaN(numericValue) ? null : numericValue;
    return this;
  }

  // Função: Define o consumo, incluindo a lógica de conversão de string para number.
  public setConsumption(consumption: string): ConsumptionRecordBuilder {
    const numericConsumption = parseFloat(consumption.replace(',', '.'));
    this.record.consumption = isNaN(numericConsumption) ? null : numericConsumption;
    return this;
  }

  // 3. O método de construção
  // Função: Retorna o objeto Produto finalizado, com validação.
  public build(): ConsumptionRecord {
    if (!this.record.file) {
      throw new Error("O registro de consumo deve ter um arquivo anexado.");
    }
    return this.record;
  }
}
\`\`\`

### 1.5. Diretor (Upload.tsx)

O componente `Upload.tsx` atua como o **Director**, coordenando os passos de construção na função `handleSubmit`:

\`\`\`typescript
// Trecho de src/pages/Upload.tsx

const handleSubmit = (type: 'agua' | 'energia') => {
  try {
    // ... (obtenção dos valores dos inputs)

    // 4. Director: Coordena a construção do objeto
    const record: ConsumptionRecord = new ConsumptionRecordBuilder(type)
      .setFile(uploadedFiles[type])
      .setValue(valueInput)
      .setConsumption(consumptionInput)
      .build(); // O método build retorna o objeto final

    // ... (simulação de envio do objeto record)
  } catch (error) {
    // ... (tratamento de erro)
  }
};
\`\`\`

### 1.6. Benefícios

*   **Construção Passo a Passo:** Permite a construção do objeto em etapas, garantindo que o objeto final seja válido.
*   **Encapsulamento da Lógica:** A lógica de conversão de tipos e validação (ex: conversão de string para número) está isolada no Builder.
*   **Código Limpo:** O componente `Upload.tsx` não precisa se preocupar com a complexidade da inicialização do objeto, apenas com a ordem dos passos.

**Arquivos Envolvidos:**
*   `src/pages/Upload.tsx` (Modificado)
*   `src/lib/ConsumptionRecordBuilder.ts` (Criado)
